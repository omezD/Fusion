{% load static %}
{% block finalregister %}

<style type="text/css">
    table#view_1 {
        border-style: hidden;
        width: 100%;
    }
</style>


<center><b>Swayam Registration</b></center>

<div class="ui vertical segment">
    {% if curr_sem.semester_no != 8 %}
    {% if swayam_registration_flag == True %}
    <form id='student_register' action='/academic-procedures/auto_pre_registration/'>
        {% csrf_token %}
        <table id="registration_courses_table" class="ui very basic collapsing celled sortable table" style="padding-left: 2.5%;
                                    padding-right: 2.5%;
                                    padding-top: .25%;
                                    padding-bottom: .25%;
                                    margin: auto;">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Slot name</th>
                    <th>Slot type</th>
                    <th>Semester</th>
                    <th>Credits</th>
                    <th>Priority</th>
                    <th>Select</th>
                    <th>Registration Type</th>
                </tr>
            </thead>

            <tbody>
                <input type="text" hidden="true" id="mincr" value="{{curr_sem.curriculum.min_credit}}">
                {% for course_slot in current_sem_registration_courses %}
                    {% if course_slot.type == "Swayam" %}
                        <input type="text" name='course_slot' value='{{ course_slot.id }}' hidden="True"
                            data-value2='{{course_slot.type}}'>
                        <tr>
                            <td>{{ forloop.counter }}.</td>
                            <td>{{course_slot.name}}</td>
                            <td>{{course_slot.type}}</td>
                            <td>{{next_sem.semester_no}}
                                <input type="text" name='semester' value='{{ next_sem.id }}' hidden="True">
                            </td>
                            <td id="credit_values_course" class="credit_values">{{course_slot.courses.all.0.credit}} </td>
                            <td> 
                                <div style="margin-top: 5px;margin-bottom:5px;">
                                    <select  class="ui dropdown choicesBox" required="True" name="course_priority-{{course_slot.id}}">
                                        <option value="NULL">Choices</option>
                                        {% for course in course_slot.courses.all %}
                                        <option value='{{1}}-{{course.id}}' class="Prechoices"
                                        data-value2="{{course.credit}}">
                                        {{course.code}}-{{ course.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </td>
                        </tr>
                        <input type="text" name="ct" value="{{forloop.counter}}" hidden="True">
                    {% elif course_slot.type == "Open Elective" %}
                        {% for course in course_slot.courses.all %}
                        <input type="text" name='course_slot' value='{{ course_slot.id }}' hidden="True"
                        data-value2='{{course_slot.type}}'>
                            <tr>
                                <td>{{ forloop.parentloop.counter }}.</td>
                                <td>{{ course_slot.name }}</td>
                                <td>{{ course_slot.type }}</td>
                                <td>{{ next_sem.semester_no }}
                                    <input type="text" name='semester' value='{{ next_sem.id }}' hidden="True">
                                </td>
                                <td id="credit_values_course" class="credit_values">{{ course.credit }} </td>
                                <td id="priority" class="priority">{{ forloop.counter }} </td>
                                <td> 
                                    <div style="margin-top: 5px;margin-bottom:5px;">
                                        <select class="ui dropdown choicesBox" required="True" name="course_priority-{{ course_slot.id }}">
                                            <option value="NULL">Choices</option>
                                            {% for course1 in course_slot.courses.all %}
                                            <option value='{{ forloop.parentloop.counter }}-{{ course1.id }}' class="Prechoices" data-value2="{{ course1.credit }}">
                                                {{ course1.code }}-{{ course1.name }}
                                            </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                    
                        <input type="text" name='course_slot' value='{{ course_slot.id }}' hidden="True"
                            data-value2='{{course_slot.type}}'>
                        <tr>
                            <td>{{forloop.counter}}.</td>
                            <td>{{course_slot.name}}</td>
                            <td>{{course_slot.type}}</td>
                            <td>{{next_sem.semester_no}}
                                <input type="text" name='semester' value='{{ next_sem.id }}' hidden="True">
                            </td>
                            <td id="credit_values_course" class="credit_values">{{course_slot.courses.all.0.credit}} </td>
                            <td> 
                                <div style="margin-top: 5px;margin-bottom:5px;">
                                    <select  class="ui dropdown choicesBox" required="True" name="course_priority-{{course_slot.id}}">
                                        <option value="NULL">Choices</option>
                                        {% for course in course_slot.courses.all %}
                                        <option value='{{1}}-{{course.id}}' class="Prechoices"
                                        data-value2="{{course.credit}}">
                                        {{course.code}}-{{ course.name }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </td>
                            {% if course_slot.type == "Backlog" %}
                            <td>
                                <div style="margin-top: 5px;margin-bottom:5px;">
                                    <select  class="ui dropdown choicesBox" required="True" name="registration_type-{{course_slot.id}}">
                                        <option value="NULL">Choices</option>
                                        <option value='Regular' class="Registration_Type">Regular</option>
                                        <option value='Audit' class="Registration_Type">Audit</option>
                                        <option value='Improvement' class="Registration_Type">Improvement</option>
                                        <option value='Backlog' class="Registration_Type">Backlog</option>
                                    </select>
                                </div>
                            </td>
                            {% endif %}
                        </tr>
                        <input type="text" name="ct" value="{{forloop.counter}}" hidden="True">
                    
                    {% endif %}
                {% endfor %}
                <input type="text" name='user' value='{{ details.current_user}}' hidden="True">

            </tbody>
            
        </table>
        <div class="extra content">
            <div class="" style="text-align: center;">
                <button id="register-button" class="ui primary button">Register</button>
            </div>
        </div>
    </form>

    <br>
    <br>
    {% else %}
    <CENTER>
        <p style="color: red"> Swayam Registration Date is yet to come </p>
    </CENTER>
    {% endif %}
    {% else %}
    <CENTER>
        <p style="color: red"> You are not Eligible for Registration !! </p>
    </CENTER>
    {% endif %}
</div>
{% endblock %}
 
 
 
 
 
 
<script type="text/javascript" src="{% static 'globals/js/jquery.min.js' %}"></script>
<script type="text/javascript">
    $(function () {
        $('#change_reg').on('click', function (e) {
            $('#view_1').hide();
            $('#course_change_table').show();
        });
        $('#viewbtn1').on('click', function (e) {
            $('#course_change_table').hide();
            $('#view_1').show();
        });
        /*$("#final_student_register").submit(function (event) {
 
            event.preventDefault();
            var friendForm = $(this);
 
            var posting = $.post(friendForm.attr('action'), friendForm.serialize());
            // if success:
            posting.done(function (data) {
                alert('Registration Successful');
                window.location = "/academic-procedures/main/";
            });
            // if failure
            posting.fail(function (data) {
                alert('Registration Failed');
                window.location = "/academic-procedures/main/";
            });
        });*/
        $("#change_course").submit(function (event) {
 
            var inp = document.getElementsByClassName("choices");
            var count = 0;
            for (var i = 0; i < inp.length; i++) {
                if (inp[i].selected) {
                    count = count + parseInt(inp[i].getAttribute("data-value2"));
                }
            }
 
            event.preventDefault();
            var friendForm = $(this);
 
            var posting = $.post(friendForm.attr('action'), friendForm.serialize());
 
            var min = parseInt(document.getElementById("mincr").value);
            if (count <= min) {
                alert("You Can't Register as Minimum Credits: " + min);
                window.location = "/academic-procedures/main/"
            }
            else {
                // if success:
                posting.done(function (data) {
                    alert('Registration Successful');
                    window.location = "/academic-procedures/main/";
                });
                // if failure
                posting.fail(function (data) {
                    alert('Registration Failed');
                    window.location = "/academic-procedures/main/";
                });
            }
        });
        //function to detect value change on mode
        $("#mode").on("change", function () {
            if($("#mode")[0].value === "Edu Loan"){
                //Disable transaction_id field
                $("#transaction_id")[0].required = false;
                $("#transaction_id")[0].value = "";
                $("#transaction_id")[0].disabled = true;
                //Disable edu_loan checkbox
                if($("#edu_loan")[0].checked === false){
                    $("#edu_loan").trigger("click");
                }  
                $("#edu_loan")[0].disabled = true;
            }
            else {
                $("#transaction_id")[0].required = true;
                $("#transaction_id")[0].disabled = false;
                //Enable edu_loan checkbox
                $("#edu_loan")[0].disabled = false;
                if($("#edu_loan")[0].checked === true){
                    $("#edu_loan").trigger("click");
                }  
            }
        });
        //function for edu_loan checkbox and related utr_number field
        $("#edu_loan").on('change',function () {
            if (this.checked) {
                $("#utr_number")[0].disabled = false;
                $("#utr_number")[0].required = true;
            } else {
                $("#utr_number")[0].disabled = true;
                $("#utr_number")[0].value = "";
            }
        });
        //function to check file size on upload
        $("#fee_receipt").on("change", function () {
            const file = this.files[0];
            const fileExt = file.name.substr(file.name.lastIndexOf('.') + 1);
            if (fileExt != "pdf") {
                alert("Supported file type is *.pdf");
                $("#fee_receipt")[0].value = "";
            }
            else if (file.size > 512000) {
                alert("File size is more than 500KB");
                $("#fee_receipt")[0].value = "";
            }
        });
    });
 
</script>